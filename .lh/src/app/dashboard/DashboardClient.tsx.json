{
    "sourceFile": "src/app/dashboard/DashboardClient.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1762629648870,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1762629657857,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -187,18 +187,23 @@\n       </div>\r\n \r\n       {/* Onboarding Modal - Auto-show for new users */}\r\n       {showOnboarding && (\r\n-        <div>\r\n           <SurveyModal\r\n             onComplete={(profile) => {\r\n               console.debug('[Dashboard] SurveyModal onComplete', profile);\r\n               setShowOnboarding(false);\r\n+              localStorage.removeItem('survey-shown'); // Clear flag so it doesn't show again\r\n               setOnboardingData({ hasCompletedOnboarding: true, profile });\r\n+              // Optionally refresh the page or show a success message\r\n+              window.location.reload(); // Refresh to update the UI\r\n             }}\r\n-            onSkip={() => { console.debug('[Dashboard] SurveyModal onSkip'); setShowOnboarding(false); }}\r\n+            onSkip={() => { \r\n+              console.debug('[Dashboard] SurveyModal onSkip'); \r\n+              setShowOnboarding(false);\r\n+              localStorage.setItem('survey-skipped', 'true'); // Mark as skipped\r\n+            }}\r\n           />\r\n-        </div>\r\n       )}\r\n     </div>\r\n   );\r\n }\r\n"
                },
                {
                    "date": 1762629666082,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -90,9 +90,13 @@\n           <h1 className=\"github-page-title\">Welcome{user?.name ? `, ${user.name}` : ''}! ðŸ‘‹</h1>\r\n           <p className=\"github-page-description\">Choose where you'd like to start</p>\r\n         </div>\r\n         <div style={{ marginLeft: 'auto' }}>\r\n-          {/* Show 'Take Survey' card-style button only when survey not completed */}\r\n+            <div onClick={() => { \r\n+              console.debug('[Dashboard] Take Survey clicked'); \r\n+              localStorage.removeItem('survey-skipped'); // Allow retaking if previously skipped\r\n+              setShowOnboarding(true); \r\n+            }} className=\"github-card github-card-interactive\" style={{ cursor: 'pointer', display: 'inline-flex', alignItems: 'center', padding: '10px 18px', borderRadius: 12, background: 'linear-gradient(135deg,#FFE6D1,#FFD8C0)' }}>\r\n           {onboardingData && !onboardingData.hasCompletedOnboarding && (\r\n             <div onClick={() => { console.debug('[Dashboard] Take Survey clicked'); setShowOnboarding(true); }} className=\"github-card github-card-interactive\" style={{ cursor: 'pointer', display: 'inline-flex', alignItems: 'center', padding: '10px 18px', borderRadius: 12, background: 'linear-gradient(135deg,#FFE6D1,#FFD8C0)' }}>\r\n               <div style={{ width: 36, height: 36, borderRadius: 8, background: '#FFF', display: 'flex', alignItems: 'center', justifyContent: 'center', marginRight: 10 }}>\r\n                 <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M12 2L2 7l10 5 10-5-10-5z\" fill=\"#D2691E\"/></svg>\r\n"
                }
            ],
            "date": 1762629648870,
            "name": "Commit-0",
            "content": "\"use client\";\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { setUser as setGlobalUser } from '@/lib/user-client';\r\nimport { signOut } from '@/lib/auth-client';\r\nimport { useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport SurveyModal from '@/components/SurveyModal';\r\n\r\ninterface User {\r\n  id: string;\r\n  name?: string;\r\n  email: string;\r\n  avatar?: string;\r\n  xp?: number;\r\n  level?: number;\r\n}\r\n\r\nexport default function DashboardClient({ initialUser }: { initialUser: User | null }) {\r\n  const [user, setUser] = useState<User | null>(null); // Start with null to force fresh fetch\r\n  const [loading, setLoading] = useState<boolean>(true); // Always start loading\r\n  const [showOnboarding, setShowOnboarding] = useState<boolean>(false);\r\n  const [onboardingData, setOnboardingData] = useState<any>(null);\r\n  const router = useRouter();\r\n\r\n  useEffect(() => {\r\n    // Always fetch fresh user data on mount to avoid showing cached data\r\n    const fetchUser = async () => {\r\n      try {\r\n        const res = await fetch('/api/dashboard', {\r\n          cache: 'no-store',\r\n          headers: {\r\n            'Cache-Control': 'no-cache, no-store, must-revalidate',\r\n            'Pragma': 'no-cache',\r\n            'Expires': '0'\r\n          }\r\n        });\r\n        if (!res.ok) throw new Error('Unauthorized');\r\n\r\n        const data = await res.json();\r\n        setUser(data.user);\r\n        setGlobalUser(data.user || null);\r\n\r\n        // Check onboarding status and auto-show survey if not completed\r\n        try {\r\n          const onboardingRes = await fetch('/api/onboarding');\r\n          if (onboardingRes.ok) {\r\n            const onboardingJson = await onboardingRes.json();\r\n            setOnboardingData(onboardingJson);\r\n            // Auto-show survey modal if not completed (only on first visit)\r\n            if (!onboardingJson.hasCompletedOnboarding && !localStorage.getItem('survey-shown')) {\r\n              setShowOnboarding(true);\r\n              localStorage.setItem('survey-shown', 'true');\r\n            }\r\n          }\r\n        } catch (err) {\r\n          console.error('Failed to check onboarding status:', err);\r\n        }\r\n      } catch {\r\n        // Clear session using better-auth and redirect\r\n        await signOut();\r\n        router.push('/auth/login');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchUser();\r\n  }, [router]);\r\n\r\n  // Log when the onboarding modal is toggled (avoid inline console.debug in JSX)\r\n  useEffect(() => {\r\n    console.debug('[Dashboard] showOnboarding state changed:', showOnboarding);\r\n  }, [showOnboarding]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"github-loading\">\r\n        <div className=\"github-spinner\" />\r\n        <p>Loading your dashboard...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"github-container\">\r\n      <div className=\"github-page-header\">\r\n        <div>\r\n          <h1 className=\"github-page-title\">Welcome{user?.name ? `, ${user.name}` : ''}! ðŸ‘‹</h1>\r\n          <p className=\"github-page-description\">Choose where you'd like to start</p>\r\n        </div>\r\n        <div style={{ marginLeft: 'auto' }}>\r\n          {/* Show 'Take Survey' card-style button only when survey not completed */}\r\n          {onboardingData && !onboardingData.hasCompletedOnboarding && (\r\n            <div onClick={() => { console.debug('[Dashboard] Take Survey clicked'); setShowOnboarding(true); }} className=\"github-card github-card-interactive\" style={{ cursor: 'pointer', display: 'inline-flex', alignItems: 'center', padding: '10px 18px', borderRadius: 12, background: 'linear-gradient(135deg,#FFE6D1,#FFD8C0)' }}>\r\n              <div style={{ width: 36, height: 36, borderRadius: 8, background: '#FFF', display: 'flex', alignItems: 'center', justifyContent: 'center', marginRight: 10 }}>\r\n                <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M12 2L2 7l10 5 10-5-10-5z\" fill=\"#D2691E\"/></svg>\r\n              </div>\r\n              <div style={{ display: 'flex', flexDirection: 'column' }}>\r\n                <div style={{ fontWeight: 800, color: '#8B4513' }}>Take Survey</div>\r\n                <div style={{ fontSize: 12, color: '#A0522D' }}>Personalize your learning</div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"github-dashboard-grid\">\r\n  <Link href=\"/dashboard/home\" className=\"github-card github-card-interactive\">\r\n          <div className=\"github-card-icon github-card-icon-home\">\r\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\r\n              <path d=\"M6.906.664a1.749 1.749 0 012.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0113.25 15h-3.5a.75.75 0 01-.75-.75V9H7v5.25a.75.75 0 01-.75.75h-3.5A1.75 1.75 0 011 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2z\"/>\r\n            </svg>\r\n          </div>\r\n          <div className=\"github-card-content\">\r\n            <div className=\"github-card-title\">Home</div>\r\n            <div className=\"github-card-description\">Your personalized dashboard with quick access to everything</div>\r\n          </div>\r\n          <div className=\"github-card-arrow\">â†’</div>\r\n  </Link>\r\n\r\n  <Link href=\"/dashboard/calendar\" className=\"github-card github-card-interactive\">\r\n          <div className=\"github-card-icon github-card-icon-calendar\">\r\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\r\n              <path d=\"M4.75 0a.75.75 0 01.75.75V2h5V.75a.75.75 0 011.5 0V2h1.25c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0113.25 16H2.75A1.75 1.75 0 011 14.25V3.75C1 2.784 1.784 2 2.75 2H4V.75A.75.75 0 014.75 0zm0 3.5h8.5a.25.25 0 01.25.25V6h-11V3.75a.25.25 0 01.25-.25h2.5z\"/>\r\n            </svg>\r\n          </div>\r\n          <div className=\"github-card-content\">\r\n            <div className=\"github-card-title\">Calendar</div>\r\n            <div className=\"github-card-description\">Plan your day and track upcoming tasks</div>\r\n          </div>\r\n          <div className=\"github-card-arrow\">â†’</div>\r\n  </Link>\r\n\r\n  <Link href=\"/dashboard/tasks\" className=\"github-card github-card-interactive\">\r\n          <div className=\"github-card-icon\" style={{ background: 'linear-gradient(135deg, #60A5FA, #3B82F6)' }}>\r\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 16 16\" fill=\"currentColor\" style={{ color: 'white' }}>\r\n              <path d=\"M1.5 3.25a2.25 2.25 0 113.5 2.5c0-.66-.27-1.26-.7-1.69a.75.75 0 00-1.05 1.06c.2.2.3.47.3.63a.75.75 0 01-1.5 0 1.75 1.75 0 111.75-1.75v-.25a.75.75 0 00-1.5 0v1.75c0 .138.112.25.25.25h3.5a.75.75 0 000-1.5h-3.5A1.75 1.75 0 011.5 3.25zM0 4.87C0 3.84 1.03 3 2.25 3h.5a.75.75 0 010 1.5h-.5A.75.75 0 002.25 6H3.5v1.75a.75.75 0 01-1.5 0v-1.75H1.5v3.75a.75.75 0 01-1.5 0V4.87z\"/>\r\n              <path d=\"M12.25 1H11.5a.75.75 0 000 1.5h.75c.966 0 1.75.784 1.75 1.75v9.5A1.75 1.75 0 0112.25 15h-8.5A1.75 1.75 0 012 13.25v-9.5C2 2.784 2.784 2 3.75 2h.75a.75.75 0 000-1.5h-.75A3.25 3.25 0 001 3.75v9.5A3.25 3.25 0 004.25 16h8.5A3.25 3.25 0 0016 12.75v-9.5A3.25 3.25 0 0012.25 0h-.75a.75.75 0 000 1.5h.75z\"/>\r\n            </svg>\r\n          </div>\r\n          <div className=\"github-card-content\">\r\n            <div className=\"github-card-title\">Tasks</div>\r\n            <div className=\"github-card-description\">Manage your tasks with Kanban board and AI summaries</div>\r\n          </div>\r\n          <div className=\"github-card-arrow\">â†’</div>\r\n  </Link>\r\n\r\n  <Link href=\"/learn\" className=\"github-card github-card-interactive\">\r\n          <div className=\"github-card-icon github-card-icon-learn\">\r\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\r\n              <path d=\"M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0114.25 13H8.06l-2.573 2.573A1.458 1.458 0 013 14.543V13H1.75A1.75 1.75 0 010 11.25v-9.5zM1.75 1.5a.25.25 0 00-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 01.75.75v2.19l2.72-2.72a.75.75 0 01.53-.22h6.5a.25.25 0 00.25-.25v-9.5a.25.25 0 00-.25-.25H1.75z\"/>\r\n            </svg>\r\n          </div>\r\n          <div className=\"github-card-content\">\r\n            <div className=\"github-card-title\">Learn</div>\r\n            <div className=\"github-card-description\">Interactive lessons and AI-powered learning</div>\r\n          </div>\r\n          <div className=\"github-card-arrow\">â†’</div>\r\n  </Link>\r\n\r\n  <Link href=\"/dashboard/assistant\" className=\"github-card github-card-interactive\">\r\n          <div className=\"github-card-icon github-card-icon-assistant\">\r\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\r\n              <path d=\"M1.75 1A1.75 1.75 0 000 2.75v8.5C0 12.216.784 13 1.75 13h3.5l2.83 2.83a.75.75 0 001.14-.19l.66-1.31.66 1.31a.75.75 0 001.14.19L14.25 13h.5A1.25 1.25 0 0016 11.75v-9A1.25 1.25 0 0014.75 1.5h-13zm0 10.5a.25.25 0 01-.25-.25v-8.5a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v8.5a.25.25 0 01-.25.25h-3.5a.75.75 0 00-.531.22L8 13.72l-2.22-2.22a.75.75 0 00-.53-.22h-3.5z\"/>\r\n              <path d=\"M5 5.25a.75.75 0 01.75-.75h4.5a.75.75 0 010 1.5h-4.5A.75.75 0 015 5.25zM5 8.25a.75.75 0 01.75-.75h2.5a.75.75 0 010 1.5h-2.5A.75.75 0 015 8.25z\"/>\r\n            </svg>\r\n          </div>\r\n          <div className=\"github-card-content\">\r\n            <div className=\"github-card-title\">Assistant</div>\r\n            <div className=\"github-card-description\">Get help with homework and instant grading</div>\r\n          </div>\r\n          <div className=\"github-card-arrow\">â†’</div>\r\n  </Link>\r\n\r\n  <Link href=\"/dashboard/profile\" className=\"github-card github-card-interactive\">\r\n          <div className=\"github-card-icon github-card-icon-profile\">\r\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\r\n              <path d=\"M10.561 8.073a6.005 6.005 0 003.432-5.142.75.75 0 10-1.498.07 4.5 4.5 0 01-8.99 0 .75.75 0 00-1.498-.07 6.004 6.004 0 003.431 5.142 3.999 3.999 0 00-1.989 3.178.75.75 0 101.493.154 2.5 2.5 0 014.992 0 .75.75 0 101.493-.154 4 4 0 00-1.989-3.178z\"/>\r\n            </svg>\r\n          </div>\r\n          <div className=\"github-card-content\">\r\n            <div className=\"github-card-title\">Profile</div>\r\n            <div className=\"github-card-description\">Manage your account and settings</div>\r\n          </div>\r\n          <div className=\"github-card-arrow\">â†’</div>\r\n  </Link>\r\n      </div>\r\n\r\n      {/* Onboarding Modal - Optional */}\r\n      {showOnboarding && (\r\n        <div>\r\n          <SurveyModal\r\n            onComplete={(profile) => {\r\n              console.debug('[Dashboard] SurveyModal onComplete', profile);\r\n              setShowOnboarding(false);\r\n              setOnboardingData({ hasCompletedOnboarding: true, profile });\r\n            }}\r\n            onSkip={() => { console.debug('[Dashboard] SurveyModal onSkip'); setShowOnboarding(false); }}\r\n          />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"
        }
    ]
}