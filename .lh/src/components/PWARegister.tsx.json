{
    "sourceFile": "src/components/PWARegister.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1761191483650,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1761191960934,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,19 +7,8 @@\n   const [showUpdatePrompt, setShowUpdatePrompt] = useState(false);\r\n \r\n   useEffect(() => {\r\n     // Temporarily disable Service Worker registration for development\r\n-    // Unregister any existing service workers to prevent offline page issues\r\n-    if ('serviceWorker' in navigator) {\r\n-      navigator.serviceWorker.getRegistrations().then((registrations) => {\r\n-        registrations.forEach((registration) => {\r\n-          registration.unregister().then(() => {\r\n-            console.log('[PWA] Service Worker désenregistré pour le développement');\r\n-          });\r\n-        });\r\n-      });\r\n-    }\r\n-\r\n     // if ('serviceWorker' in navigator) {\r\n     //   const register = async () => {\r\n     //     try {\r\n     //       const registration = await navigator.serviceWorker.register('/sw.js', {\r\n"
                },
                {
                    "date": 1762627098294,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,65 +6,24 @@\n   const [deferredPrompt, setDeferredPrompt] = useState<any>(null);\r\n   const [showUpdatePrompt, setShowUpdatePrompt] = useState(false);\r\n \r\n   useEffect(() => {\r\n-    // Temporarily disable Service Worker registration for development\r\n-    // if ('serviceWorker' in navigator) {\r\n-    //   const register = async () => {\r\n-    //     try {\r\n-    //       const registration = await navigator.serviceWorker.register('/sw.js', {\r\n-    //         scope: '/'\r\n-    //       });\r\n-          \r\n-    //       console.log('[PWA] Service Worker enregistré:', registration.scope);\r\n+    // TEMPORARILY DISABLE SERVICE WORKER FOR DEVELOPMENT\r\n+    // Service Worker is causing navigation issues and offline page redirects\r\n+    console.log('[PWA] Service Worker disabled for development');\r\n+    \r\n+    // Unregister any existing service workers\r\n+    if ('serviceWorker' in navigator) {\r\n+      navigator.serviceWorker.getRegistrations().then(registrations => {\r\n+        registrations.forEach(registration => {\r\n+          console.log('[PWA] Unregistering service worker:', registration.scope);\r\n+          registration.unregister();\r\n+        });\r\n+      });\r\n+    }\r\n \r\n-    //       // Vérifier les mises à jour toutes les heures\r\n-    //       setInterval(() => {\r\n-    //         registration.update();\r\n-    //       }, 60 * 60 * 1000);\r\n-\r\n-    //       // Détecter une nouvelle version du SW\r\n-    //       registration.addEventListener('updatefound', () => {\r\n-    //         const newWorker = registration.installing;\r\n-    //         if (newWorker) {\r\n-    //           newWorker.addEventListener('statechange', () => {\r\n-    //             if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\r\n-    //               // Nouvelle version disponible\r\n-    //               setShowUpdatePrompt(true);\r\n-    //             }\r\n-    //           });\r\n-    //         }\r\n-    //       });\r\n-    //     } catch (err) {\r\n-    //       console.warn('[PWA] Échec enregistrement SW:', err);\r\n-    //     }\r\n-    //   };\r\n-    //   register();\r\n-    // }    // Détecter l'événement d'installation PWA\r\n-    const handleBeforeInstallPrompt = (e: Event) => {\r\n-      e.preventDefault();\r\n-      setDeferredPrompt(e);\r\n-      \r\n-      // Montrer rapidement pour les tests (5 secondes au lieu de 30)\r\n-      setTimeout(() => {\r\n-        const hasSeenPrompt = localStorage.getItem('pwa-install-prompt-seen');\r\n-        if (!hasSeenPrompt) {\r\n-          setShowInstallPrompt(true);\r\n-        }\r\n-      }, 5000); // Attendre 5 secondes seulement\r\n-    };\r\n-\r\n-    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n-\r\n-    // Détecter si l'app est déjà installée\r\n-    window.addEventListener('appinstalled', () => {\r\n-      console.log('[PWA] Application installée!');\r\n-      setShowInstallPrompt(false);\r\n-      setDeferredPrompt(null);\r\n-    });\r\n-\r\n     return () => {\r\n-      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n+      // Cleanup if needed\r\n     };\r\n   }, []);\r\n \r\n   const handleInstallClick = async () => {\r\n"
                }
            ],
            "date": 1761191483650,
            "name": "Commit-0",
            "content": "\"use client\";\r\nimport { useEffect, useState } from 'react';\r\n\r\nexport default function PWARegister() {\r\n  const [showInstallPrompt, setShowInstallPrompt] = useState(false);\r\n  const [deferredPrompt, setDeferredPrompt] = useState<any>(null);\r\n  const [showUpdatePrompt, setShowUpdatePrompt] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Temporarily disable Service Worker registration for development\r\n    // Unregister any existing service workers to prevent offline page issues\r\n    if ('serviceWorker' in navigator) {\r\n      navigator.serviceWorker.getRegistrations().then((registrations) => {\r\n        registrations.forEach((registration) => {\r\n          registration.unregister().then(() => {\r\n            console.log('[PWA] Service Worker désenregistré pour le développement');\r\n          });\r\n        });\r\n      });\r\n    }\r\n\r\n    // if ('serviceWorker' in navigator) {\r\n    //   const register = async () => {\r\n    //     try {\r\n    //       const registration = await navigator.serviceWorker.register('/sw.js', {\r\n    //         scope: '/'\r\n    //       });\r\n          \r\n    //       console.log('[PWA] Service Worker enregistré:', registration.scope);\r\n\r\n    //       // Vérifier les mises à jour toutes les heures\r\n    //       setInterval(() => {\r\n    //         registration.update();\r\n    //       }, 60 * 60 * 1000);\r\n\r\n    //       // Détecter une nouvelle version du SW\r\n    //       registration.addEventListener('updatefound', () => {\r\n    //         const newWorker = registration.installing;\r\n    //         if (newWorker) {\r\n    //           newWorker.addEventListener('statechange', () => {\r\n    //             if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {\r\n    //               // Nouvelle version disponible\r\n    //               setShowUpdatePrompt(true);\r\n    //             }\r\n    //           });\r\n    //         }\r\n    //       });\r\n    //     } catch (err) {\r\n    //       console.warn('[PWA] Échec enregistrement SW:', err);\r\n    //     }\r\n    //   };\r\n    //   register();\r\n    // }    // Détecter l'événement d'installation PWA\r\n    const handleBeforeInstallPrompt = (e: Event) => {\r\n      e.preventDefault();\r\n      setDeferredPrompt(e);\r\n      \r\n      // Montrer rapidement pour les tests (5 secondes au lieu de 30)\r\n      setTimeout(() => {\r\n        const hasSeenPrompt = localStorage.getItem('pwa-install-prompt-seen');\r\n        if (!hasSeenPrompt) {\r\n          setShowInstallPrompt(true);\r\n        }\r\n      }, 5000); // Attendre 5 secondes seulement\r\n    };\r\n\r\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n\r\n    // Détecter si l'app est déjà installée\r\n    window.addEventListener('appinstalled', () => {\r\n      console.log('[PWA] Application installée!');\r\n      setShowInstallPrompt(false);\r\n      setDeferredPrompt(null);\r\n    });\r\n\r\n    return () => {\r\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n    };\r\n  }, []);\r\n\r\n  const handleInstallClick = async () => {\r\n    if (!deferredPrompt) return;\r\n\r\n    deferredPrompt.prompt();\r\n    const { outcome } = await deferredPrompt.userChoice;\r\n    \r\n    console.log('[PWA] Installation:', outcome);\r\n    \r\n    setDeferredPrompt(null);\r\n    setShowInstallPrompt(false);\r\n    localStorage.setItem('pwa-install-prompt-seen', 'true');\r\n  };\r\n\r\n  const handleDismissInstall = () => {\r\n    setShowInstallPrompt(false);\r\n    localStorage.setItem('pwa-install-prompt-seen', 'true');\r\n  };\r\n\r\n  const handleUpdate = () => {\r\n    // Dire au SW de skip waiting et activer immédiatement\r\n    if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {\r\n      navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });\r\n    }\r\n    \r\n    // Recharger la page après un court délai\r\n    setTimeout(() => {\r\n      window.location.reload();\r\n    }, 500);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Prompt d'installation PWA */}\r\n      {showInstallPrompt && (\r\n        <div style={{\r\n          position: 'fixed',\r\n          bottom: '20px',\r\n          left: '50%',\r\n          transform: 'translateX(-50%)',\r\n          background: 'var(--bg-secondary)',\r\n          border: '1px solid var(--border)',\r\n          borderRadius: '12px',\r\n          padding: '1rem 1.5rem',\r\n          maxWidth: '400px',\r\n          width: '90%',\r\n          boxShadow: '0 10px 40px rgba(0,0,0,0.3)',\r\n          zIndex: 9999,\r\n          animation: 'slideUp 0.3s ease-out'\r\n        }}>\r\n          <div style={{ display: 'flex', alignItems: 'start', gap: '1rem' }}>\r\n            <div style={{ flex: 1 }}>\r\n              <h3 style={{ margin: 0, marginBottom: '0.5rem', fontSize: '1rem', fontWeight: '600' }}>\r\n                Installer RiseUP\r\n              </h3>\r\n              <p style={{ margin: 0, fontSize: '0.875rem', color: 'var(--fg-muted)', marginBottom: '1rem' }}>\r\n                Installez l'application pour un accès rapide et une expérience hors ligne.\r\n              </p>\r\n              <div style={{ display: 'flex', gap: '0.5rem' }}>\r\n                <button\r\n                  onClick={handleInstallClick}\r\n                  style={{\r\n                    padding: '0.5rem 1rem',\r\n                    background: 'var(--primary)',\r\n                    color: 'white',\r\n                    border: 'none',\r\n                    borderRadius: '6px',\r\n                    fontSize: '0.875rem',\r\n                    fontWeight: '500',\r\n                    cursor: 'pointer'\r\n                  }}\r\n                >\r\n                  Installer\r\n                </button>\r\n                <button\r\n                  onClick={handleDismissInstall}\r\n                  style={{\r\n                    padding: '0.5rem 1rem',\r\n                    background: 'transparent',\r\n                    color: 'var(--fg-muted)',\r\n                    border: '1px solid var(--border)',\r\n                    borderRadius: '6px',\r\n                    fontSize: '0.875rem',\r\n                    cursor: 'pointer'\r\n                  }}\r\n                >\r\n                  Plus tard\r\n                </button>\r\n              </div>\r\n            </div>\r\n            <button\r\n              onClick={handleDismissInstall}\r\n              style={{\r\n                background: 'none',\r\n                border: 'none',\r\n                fontSize: '1.25rem',\r\n                cursor: 'pointer',\r\n                color: 'var(--fg-muted)',\r\n                padding: 0,\r\n                lineHeight: 1\r\n              }}\r\n              aria-label=\"Fermer\"\r\n            >\r\n              ×\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Prompt de mise à jour */}\r\n      {showUpdatePrompt && (\r\n        <div style={{\r\n          position: 'fixed',\r\n          top: '20px',\r\n          left: '50%',\r\n          transform: 'translateX(-50%)',\r\n          background: 'var(--bg-secondary)',\r\n          border: '1px solid var(--border)',\r\n          borderRadius: '12px',\r\n          padding: '1rem 1.5rem',\r\n          maxWidth: '400px',\r\n          width: '90%',\r\n          boxShadow: '0 10px 40px rgba(0,0,0,0.3)',\r\n          zIndex: 9999,\r\n          animation: 'slideDown 0.3s ease-out'\r\n        }}>\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\r\n            <div style={{ flex: 1 }}>\r\n              <h3 style={{ margin: 0, marginBottom: '0.25rem', fontSize: '0.9rem', fontWeight: '600' }}>\r\n                Mise à jour disponible\r\n              </h3>\r\n              <p style={{ margin: 0, fontSize: '0.8rem', color: 'var(--fg-muted)' }}>\r\n                Une nouvelle version est prête\r\n              </p>\r\n            </div>\r\n            <button\r\n              onClick={handleUpdate}\r\n              style={{\r\n                padding: '0.5rem 1rem',\r\n                background: 'var(--primary)',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: '6px',\r\n                fontSize: '0.875rem',\r\n                fontWeight: '500',\r\n                cursor: 'pointer',\r\n                whiteSpace: 'nowrap'\r\n              }}\r\n            >\r\n              Actualiser\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <style jsx>{`\r\n        @keyframes slideUp {\r\n          from {\r\n            transform: translateX(-50%) translateY(100px);\r\n            opacity: 0;\r\n          }\r\n          to {\r\n            transform: translateX(-50%) translateY(0);\r\n            opacity: 1;\r\n          }\r\n        }\r\n        @keyframes slideDown {\r\n          from {\r\n            transform: translateX(-50%) translateY(-100px);\r\n            opacity: 0;\r\n          }\r\n          to {\r\n            transform: translateX(-50%) translateY(0);\r\n            opacity: 1;\r\n          }\r\n        }\r\n      `}</style>\r\n    </>\r\n  );\r\n}\r\n"
        }
    ]
}